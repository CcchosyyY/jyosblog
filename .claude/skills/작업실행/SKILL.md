---
name: 작업실행
description: 작업을 세부 단계로 분해하고, 순차/병렬 모드로 계획 후 실행한다
user-invocable: true
---

# 작업실행

사용자가 요청한 작업을 분석 → 계획 → 실행하는 워크플로우입니다.

---

## Step 1. 작업 분석

사용자의 요청을 분석하여 세부 작업(subtask)으로 분해합니다:

1. 전체 작업 범위 파악
2. subtask 목록 도출
3. 각 subtask 간 **의존 관계** 판별
4. 관련 파일/영역 사전 조사 (필요 시 Explore 에이전트 활용)

### MCP 도구 사전 탐색

subtask 도출 후, 각 작업에 관련된 MCP 도구를 `ToolSearch`로 탐색합니다.

| 작업 유형 | 탐색 대상 |
|----------|----------|
| DB 스키마/데이터 | Supabase MCP (`execute_sql`, `apply_migration` 등) |
| 디자인/UI | Pencil MCP (`batch_get`, `batch_design` 등) |
| UI 테스트 | Chrome DevTools / Puppeteer MCP |
| GitHub PR/이슈 | GitHub MCP |
| 배포 | Vercel MCP |
| 문서 조회 | context7 MCP |

**원칙**: MCP로 직접 할 수 있는 작업은 사용자에게 수동 작업을 요청하지 않습니다. 계획 보고 시 어떤 MCP를 활용할지 함께 명시합니다.

---

## Step 2. 실행 전략 결정

### 모드 선택 기준

| 모드 | 조건 |
|------|------|
| **순차 모드** | subtask가 2개 이하이거나, 모든 단계가 강하게 연결됨 |
| **병렬 모드** | subtask 간 독립적이거나, 정보 수집/검증을 동시에 할 수 있음 |
| **혼합 모드** | 일부는 병렬로 시작 → 합류 → 다음 단계는 순차 |

**중요**: 의존성이 높더라도 정보 수집, 코드 조사, 검증 등 병렬화 가능한 작업이 있다면 팀원을 배정하여 병렬로 실행합니다.

### 병렬 모드 팀 구성 (최대 4명)

| 팀원 | 역할 | 설명 |
|------|------|------|
| **구현 담당** | 핵심 기능 개발 | 요청된 기능/수정의 메인 구현 |
| **보조 담당** | 관련 코드 수정 | 유틸리티, 타입 정의, 관련 컴포넌트 수정 |
| **통합 담당** | 연동 확인, 최적화 | 기존 프로젝트/백엔드와의 연동, 코드 최적화 |
| **검증 담당** | 품질 검증 | 타입체크, 빌드 확인, 기존 기능 깨짐 여부 검증 |

- 작업 규모에 따라 2~4명 유동적으로 배정합니다.
- 하나의 subtask를 여러 팀원이 나눠 작업할 수도 있습니다.
- 팀원은 Task 도구의 `subagent_type: "general-purpose"`로 생성합니다.

### 팀원에게 전달할 컨텍스트

각 팀원(subagent)에게 작업을 배정할 때, 프롬프트에 아래 내용을 **반드시 포함**합니다:

```
프로젝트: MyBlog (Next.js 15 + Supabase + MDX 개인 블로그)
기술 스택: Next.js 15 + TypeScript + Tailwind + Supabase + MDX (next-mdx-remote)
프로젝트 루트: /home/chosangyun/MyBlog
패키지 매니저: npm (pnpm 아님)
스타일링: CSS 변수 기반 테마 (직접 색상값 사용 금지, dark: prefix 불필요)
코드 주석: 영어 OK
담당 작업: [구체적 작업 내용]
수정 대상 파일: [파일 목록]
주의사항: [다른 팀원과 겹치지 않는 파일 범위, 기존 코드 패턴 준수]
```

---

## Step 3. 계획 보고

실행 전에 아래 형식으로 사용자에게 계획을 보고합니다.

### 간단한 작업 (subtask 2개 이하)

계획을 간략히 안내하고 **승인 없이 바로 실행**합니다.

```
## 작업 계획 (간단 — 바로 진행)
- 작업: [설명]
- 모드: 순차
- 활용 MCP: [있으면 명시]
- 단계:
  1. [subtask A]
  2. [subtask B]
→ 바로 진행합니다.
```

### 복잡한 작업 (subtask 3개 이상)

계획을 상세히 보고하고 **사용자 승인 후 실행**합니다.

```
## 작업 계획

### 개요
- 작업: [설명]
- 모드: 순차 / 병렬 / 혼합
- subtask: N개
- 활용 MCP: [사용할 MCP 도구 목록]

### [순차 모드]
1. subtask A — 설명
2. subtask B — 설명 (A 완료 후)
3. subtask C — 설명 (B 완료 후)

### [병렬 모드]
| 팀원 | 담당 subtask | 작업 내용 |
|------|-------------|----------|
| 구현 담당 | subtask A | [설명] |
| 보조 담당 | subtask B | [설명] |
| 통합 담당 | subtask C | [설명] |
| 검증 담당 | subtask D | [설명] |

### [혼합 모드]
- Phase 1 (병렬): subtask A + B 동시 진행
- Phase 2 (순차): A, B 결과를 바탕으로 subtask C 진행
- Phase 3 (병렬): subtask D + E 동시 진행

→ 진행할까요?
```

---

## Step 4. 실행

### 순차 모드
- subtask를 하나씩 완료합니다.
- 각 subtask 완료 시 간단히 진행 상황을 보고합니다.

### 병렬 모드
- Task 도구로 팀원(subagent)을 **동시에** 생성하여 작업을 배정합니다.
- 각 팀원에게 **명확한 작업 범위와 수정 대상 파일**을 지정합니다.
- 팀원 간 파일 충돌을 방지하기 위해 **수정 파일이 겹치지 않도록** 배분합니다.
- 필요 시 `isolation: "worktree"`를 사용하여 격리된 환경에서 작업합니다.
- 모든 팀원 완료 후 결과를 취합하고 통합합니다.

### 혼합 모드
- Phase별로 병렬/순차를 전환하며 진행합니다.
- 각 Phase 완료 시 다음 Phase로 넘어갑니다.
- **복잡한 작업(Phase 3개 이상)에서는 Phase 전환 시 중간 결과를 사용자에게 보고**하고 방향을 확인합니다.

### 실패/충돌 대응

| 상황 | 대응 |
|------|------|
| 팀원 작업 실패 | 실패 원인 분석 → 재시도 or 다른 팀원에게 재배정 |
| 파일 충돌 발생 | 통합 담당이 충돌 병합, 통합 담당 부재 시 순차 모드로 전환 |
| 빌드/타입 에러 | 검증 담당이 발견 즉시 보고 → 구현 담당이 수정 |
| 전체 방향 틀어짐 | 작업 중단 → 사용자에게 보고 → 계획 재수립 |

---

## Step 5. 검증

작업 완료 후, 변경된 영역에 해당하는 **기존 검증 스킬을 자동 실행**합니다.

| 변경 영역 | 실행할 검증 스킬 |
|----------|----------------|
| API 라우트, 인증, Supabase | `verify-backend` |
| UI 디자인 vs 실제 화면 | `uitest` |
| 전체 구조 변경 | `verify-implementation` (모든 검증 스킬 통합 실행) |

- 검증 결과에 문제가 있으면 **자동으로 수정** 후 재검증합니다.
- 검증 통과 후 완료 보고로 넘어갑니다.

---

## Step 6. 완료 보고

모든 작업 및 검증 완료 후 아래 형식으로 보고합니다.

```
## 작업 완료

| subtask | 상태 | 변경 파일 |
|---------|------|----------|
| A | 완료 | file1.ts, file2.ts |
| B | 완료 | file3.ts |
| C | 완료 | file4.ts |

### 검증 결과
- verify-backend: 통과
- uitest: 통과

### 요약
- [변경 내용 한 줄 요약]
```
